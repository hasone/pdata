/** ! jiayouzhan 2015-12-09 */
!function(a){var b={},c={};c.attachEvent=function(b,c,d){return"addEventListener"in a?b.addEventListener(c,d,!1):void 0},c.fireFakeEvent=function(a,b){return document.createEvent?a.target.dispatchEvent(c.createEvent(b)):void 0},c.createEvent=function(b){if(document.createEvent){var c=a.document.createEvent("HTMLEvents");return c.initEvent(b,!0,!0),c.eventName=b,c}},c.getRealEvent=function(a){return a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches.length?a.originalEvent.touches[0]:a.touches&&a.touches.length?a.touches[0]:a};var d=[{test:("propertyIsEnumerable"in a||"hasOwnProperty"in document)&&(a.propertyIsEnumerable("ontouchstart")||document.hasOwnProperty("ontouchstart")),events:{start:"touchstart",move:"touchmove",end:"touchend"}},{test:a.navigator.msPointerEnabled,events:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},{test:a.navigator.pointerEnabled,events:{start:"pointerdown",move:"pointermove",end:"pointerup"}}];b.options={eventName:"tap",fingerMaxOffset:11};var e,f,g,h,i={};e=function(a){return c.attachEvent(document.body,h[a],g[a])},g={start:function(a){a=c.getRealEvent(a),i.start=[a.pageX,a.pageY],i.offset=[0,0]},move:function(a){return i.start||i.move?(a=c.getRealEvent(a),i.move=[a.pageX,a.pageY],void(i.offset=[Math.abs(i.move[0]-i.start[0]),Math.abs(i.move[1]-i.start[1])])):!1},end:function(d){if(d=c.getRealEvent(d),i.offset[0]<b.options.fingerMaxOffset&&i.offset[1]<b.options.fingerMaxOffset&&!c.fireFakeEvent(d,b.options.eventName)){if(a.navigator.msPointerEnabled||a.navigator.pointerEnabled){var e=function(a){a.preventDefault(),d.target.removeEventListener("click",e)};d.target.addEventListener("click",e,!1)}d.preventDefault()}i={}},click:function(a){return c.fireFakeEvent(a,b.options.eventName)?void 0:a.preventDefault()}},f=function(){for(var a=0;a<d.length;a++)if(d[a].test)return h=d[a].events,e("start"),e("move"),e("end"),!1;return c.attachEvent(document.body,"click",g.click)},c.attachEvent(a,"load",f),a.Tap=b}(window),function(a){a.fn.mdater=function(b){var c={maxDate:null,minDate:new Date(1970,0,1),updated:function(){},afterShow:function(){}},d=a.extend(c,b),e=this,f={getDaysInMonth:function(a,b){return new Date(a,b+1,0).getDate()},getWeekInMonth:function(a,b){return new Date(a,b,1).getDay()},getMonth:function(a){return["01","02","03","04","05","06","07","08","09","10","11","12"][a]},getLastDayInMonth:function(a,b){return new Date(a,b,this.getDaysInMonth(a,b))}};a.fn.delegates=function(b){var c=a(this[0]);for(var d in b){var e=b[d];if("function"==typeof e){var f={};f.tap=e,e=f}for(var g in e)c.delegate(d,g,e[g])}return this};var g={value:{year:"",month:"",date:""},lastCheckedDate:"",init:function(){this.renderHTML(),this.initListeners(),e[0].data=this.value,this._showPanel()},renderHTML:function(){var b=a('<div class="md_panel"><div class="md_head"><div class="md_selectarea"><a class="md_prev change_month" href="javascript:void(0);">&lt;</a><a class="md_headtext monthtag" href="javascript:void(0);">月</a><a class="md_next change_month" href="javascript:void(0);">&gt;</a></div></div><div class="md_body"><ul class="md_weekarea"><li class="red-font">日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li class="red-font">六</li></ul><ul class="md_datearea in"></ul></div>');a(document.body).prepend(b)},_showPanel:function(a){this.refreshView(),d.afterShow&&d.afterShow.apply(this,[])},_changeMonth:function(b,c){this.saveCheckedDate();var d=a(".md_selectarea").find(".monthtag"),e=~~d.data("month")+b;e>11?(e=0,this.value.year++):0>e&&(e=11,this.value.year--);var g=this.value.year+"年"+f.getMonth(e)+"月";d.text(g).data("month",e),this.value.month=e,c?this.value.date=c:this.setCheckedDate(),this.updateDate(b)},_changeYear:function(b){this.saveCheckedDate();var c=a(".md_selectarea").find(".yeartag"),d=~~c.data("year")+b;c.text(d+"年").data("year",d),this.value.year=d,this.setCheckedDate(),this.updateDate(b)},saveCheckedDate:function(){this.value.date&&(this.lastCheckedDate={year:this.value.year,month:this.value.month,date:this.value.date})},setCheckedDate:function(){this.lastCheckedDate&&this.lastCheckedDate.year===this.value.year&&this.lastCheckedDate.month===this.value.month?this.value.date=this.lastCheckedDate.date:this.value.date=""},getDateStr:function(a,b,c){for(var e="",g=f.getWeekInMonth(a,b),h=f.getDaysInMonth(a,b-1),i=g-1;i>=0;i--)e+='<li class="prevdate" data-day="'+(h-i)+'">'+(h-i)+"</li>";var j=f.getDaysInMonth(a,b),k=1,l=j,m=(new Date(a,b,c),new Date(a,b,1));if(lastDate=new Date(a,b,j),minDateDay=d.minDate.getDate(),d.minDate>lastDate?k=j+1:d.minDate>=m&&d.minDate<=lastDate&&(k=minDateDay),d.maxDate){var n=d.maxDate.getDate();d.maxDate<m?l=k-1:d.maxDate>=m&&d.maxDate<=lastDate&&(l=n)}for(var o=1;k>o;o++)e+='<li class="disabled" data-day="'+o+'">'+o+"</li>";for(var i=k;l>=i;i++){var p="";a===this.value.year&&b===this.value.month&&c===i&&(p="current"),e+='<li class="'+p+'" data-day="'+i+'">'+i+"</li>"}for(var q=l+1;j>=q;q++)e+='<li class="disabled" data-day="'+q+'">'+q+"</li>";var r=(j+g)%7;if(0!==r)for(var o=1;7-r>=o;o++)e+='<li class="nextdate" data-day="'+o+'">'+o+"</li>";return e},updateDate:function(b){var c=a(".md_datearea.in");if(1===b)var e="out_left",f="out_right";else var e="out_right",f="out_left";var g=a('<ul class="md_datearea '+f+'"></ul>');g.html(this.getDateStr(this.value.year,this.value.month,this.value.date)),a(".md_body").append(g),d.updated&&d.updated.apply(this,[g]),setTimeout(function(){g.removeClass(f).addClass("in"),c.removeClass("in").addClass(e)},0)},refreshView:function(){var b=e.val(),c=null;if(b){var g=b.split("-");c=new Date(g[0],g[1]-1,g[2])}else c=new Date;var h=this.value.year=c.getFullYear(),i=this.value.month=c.getMonth(),j=this.value.date=c.getDate();a(".yeartag").text(h+"年").data("year",h),a(".monthtag").text(h+"年"+f.getMonth(i)+"月").data("month",i);var k=this.getDateStr(h,i,j);a(".md_datearea").html(k),d.updated&&d.updated.apply(this,[a(".md_datearea")])},initListeners:function(){var b=a(".md_panel"),c=(a(".md_mask"),this);b.delegates({".change_month":function(){var b=a(this).hasClass("md_next")?1:-1;c._changeMonth(b)},".change_year":function(){var b=a(this).hasClass("md_next")?1:-1;c._changeYear(b)},".out_left, .out_right":{webkitTransitionEnd:function(){a(this).remove()}},".md_datearea li":function(){return!1}})}};g.init()}}(Zepto);